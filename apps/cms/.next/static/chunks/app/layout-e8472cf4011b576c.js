(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{1581:(e,r,t)=>{"use strict";t.d(r,{Providers:()=>w});var s=t(9694),o=t(3099),a=t(3070),n=t(9596),i=t(3438);class l{setupGlobalErrorHandlers(){window.addEventListener("unhandledrejection",e=>{var r;this.logError({type:"client_error",message:"Unhandled Promise Rejection: ".concat(e.reason),stack:null==(r=e.reason)?void 0:r.stack,additionalData:{reason:e.reason,promise:e.promise}})}),window.addEventListener("error",e=>{var r;this.logError({type:"client_error",message:e.message,stack:null==(r=e.error)?void 0:r.stack,additionalData:{filename:e.filename,lineno:e.lineno,colno:e.colno}})})}generateId(){return"".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))}getCurrentUrl(){return window.location.href}getUserAgent(){return navigator.userAgent}getSessionId(){let e=sessionStorage.getItem("error_session_id");return e||(e=this.generateId(),sessionStorage.setItem("error_session_id",e)),e}getUserId(){try{let e=localStorage.getItem("auth_user");if(e){let r=JSON.parse(e);return r.id||r.email}}catch(e){}}logError(e){let r={id:this.generateId(),type:e.type||"client_error",message:e.message||"Unknown error",stack:e.stack,url:e.url||this.getCurrentUrl(),userAgent:e.userAgent||this.getUserAgent(),timestamp:e.timestamp||new Date().toISOString(),userId:e.userId||this.getUserId(),sessionId:e.sessionId||this.getSessionId(),additionalData:e.additionalData};this.config.enableConsoleLog&&console.error("Error logged:",r),this.errorQueue.push(r),this.config.enableLocalStorage&&this.saveQueuedErrors(),this.errorQueue.length>=this.config.batchSize&&this.flush()}logApiError(e,r,t){this.logError({type:"api_error",message:e.message||"API request failed",additionalData:{url:r,method:t,status:e.status,code:e.code,details:e.details}})}logNetworkError(e,r){this.logError({type:"network_error",message:e.message||"Network request failed",additionalData:{url:r,networkError:!0}})}logValidationError(e,r){this.logError({type:"validation_error",message:"Validation failed",additionalData:{context:r,validationErrors:e}})}async flush(){if(0===this.errorQueue.length)return;let e=this.errorQueue.splice(0,this.config.batchSize);try{let r=await fetch(this.config.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({errors:e})});if(!r.ok)throw Error("HTTP ".concat(r.status,": ").concat(r.statusText));e.forEach(e=>{this.retryCount.delete(e.id)}),this.config.enableLocalStorage&&this.saveQueuedErrors()}catch(r){e.forEach(e=>{let r=this.retryCount.get(e.id)||0;r<this.config.maxRetries?(this.errorQueue.unshift(e),this.retryCount.set(e.id,r+1)):(console.error("Failed to send error after max retries:",e),this.retryCount.delete(e.id))}),setTimeout(()=>{this.flush()},this.config.retryDelay*Math.pow(2,Math.min(3,this.retryCount.size)))}}startPeriodicFlush(){this.flushTimer=setInterval(()=>{this.flush()},this.config.flushInterval)}stopPeriodicFlush(){this.flushTimer&&(clearInterval(this.flushTimer),this.flushTimer=null)}saveQueuedErrors(){try{localStorage.setItem("error_queue",JSON.stringify(this.errorQueue))}catch(e){console.error("Failed to save error queue to localStorage:",e)}}loadQueuedErrors(){try{let e=localStorage.getItem("error_queue");e&&(this.errorQueue=JSON.parse(e))}catch(e){console.error("Failed to load error queue from localStorage:",e),this.errorQueue=[]}}getQueuedErrors(){return[...this.errorQueue]}clearQueue(){this.errorQueue=[],this.retryCount.clear(),this.config.enableLocalStorage&&localStorage.removeItem("error_queue")}destroy(){this.stopPeriodicFlush(),this.flush(),this.clearQueue()}constructor(e={}){this.errorQueue=[],this.flushTimer=null,this.retryCount=new Map,this.config={apiUrl:"/api/v1/errors/report",maxRetries:3,retryDelay:1e3,batchSize:10,flushInterval:3e4,enableLocalStorage:!0,enableConsoleLog:!1,...e},this.startPeriodicFlush(),this.loadQueuedErrors(),this.setupGlobalErrorHandlers()}}let h=null;function c(){return h||(h=new l),h}function u(e,r,t){c().logApiError(e,r,t)}var d=t(7811);class m{setTokens(e,r){this.accessToken=e,this.refreshToken=r}clearTokens(){this.accessToken=null,this.refreshToken=null,this.refreshPromise=null}async refreshAccessToken(){if(!this.refreshToken)throw Error("No refresh token available");if(this.refreshPromise)return this.refreshPromise;this.refreshPromise=this.performTokenRefresh();try{return await this.refreshPromise}finally{this.refreshPromise=null}}async performTokenRefresh(){var e,r;let t=await fetch("".concat(this.baseUrl,"/api/v1/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:this.refreshToken})});if(!t.ok)throw this.clearTokens(),null==(r=this.onAuthError)||r.call(this),Error("Failed to refresh token");let s=await t.json();return this.setTokens(s.access_token,s.refresh_token),null==(e=this.onTokenRefresh)||e.call(this,s),s.access_token}async makeRequest(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.makeRequestWithRetry(e,r,0)}async makeRequestWithRetry(e,r,t){var s,o,a,n,i;let l="".concat(this.baseUrl).concat(e),h=r.method||"GET",d={"Content-Type":"application/json",...r.headers||{}};this.accessToken&&(d.Authorization="Bearer ".concat(this.accessToken));try{let i={...r,headers:d};null==(s=this.onRequestStart)||s.call(this,l,i);let c=await fetch(l,i);if(null==(o=this.onRequestEnd)||o.call(this,l,c),401===c.status&&this.refreshToken&&"/api/v1/auth/refresh"!==e)try{await this.refreshAccessToken(),d.Authorization="Bearer ".concat(this.accessToken),c=await fetch(l,{...r,headers:d})}catch(r){let e=await this.handleErrorResponse(c);return e.error&&(u(e.error,l,h),null==(a=this.onError)||a.call(this,e.error,l)),e}if(!c.ok&&this.shouldRetry(c.status,t)){let s=this.calculateRetryDelay(t);return await this.sleep(s),this.makeRequestWithRetry(e,r,t+1)}if(!c.ok){let e=await this.handleErrorResponse(c);return e.error&&(u(e.error,l,h),null==(n=this.onError)||n.call(this,e.error,l)),e}if(204===c.status||"0"===c.headers.get("content-length"))return{data:{}};return{data:await c.json()}}catch(o){if(this.shouldRetry(0,t)){let s=this.calculateRetryDelay(t);return await this.sleep(s),this.makeRequestWithRetry(e,r,t+1)}let s={code:"NETWORK_ERROR",message:o instanceof Error?o.message:"Network request failed"};return c().logNetworkError(o,l),null==(i=this.onError)||i.call(this,s,l),{error:s}}}shouldRetry(e,r){return!(r>=this.retryConfig.maxRetries)&&(0===e||this.retryConfig.retryableStatusCodes.includes(e))}calculateRetryDelay(e){let r=this.retryConfig.retryDelay;return this.retryConfig.exponentialBackoff?r*Math.pow(2,e)+1e3*Math.random():r}sleep(e){return new Promise(r=>setTimeout(r,e))}async handleErrorResponse(e){try{let r=await e.json();return{error:{code:r.code||"UNKNOWN_ERROR",message:r.message||"HTTP ".concat(e.status,": ").concat(e.statusText),details:r.details}}}catch(r){return{error:{code:"HTTP_ERROR",message:"HTTP ".concat(e.status,": ").concat(e.statusText)}}}}async login(e){let r=await this.makeRequest("/api/v1/auth/login",{method:"POST",body:JSON.stringify(e)});return r.data&&this.setTokens(r.data.access_token,r.data.refresh_token),r}async validateToken(e){return this.makeRequest("/api/v1/auth/validate",{method:"POST",body:JSON.stringify(e)})}async logout(e){let r=await this.makeRequest("/api/v1/auth/logout",{method:"POST",body:JSON.stringify(e)});return this.clearTokens(),r}async get(e,r){let t=r?"".concat(e,"?").concat(new URLSearchParams(r)):e;return this.makeRequest(t,{method:"GET"})}async post(e,r){return this.makeRequest(e,{method:"POST",body:r?JSON.stringify(r):void 0})}async put(e,r){return this.makeRequest(e,{method:"PUT",body:r?JSON.stringify(r):void 0})}async delete(e){return this.makeRequest(e,{method:"DELETE"})}async uploadFile(e,r,t){let s=new FormData;s.append("file",r),t&&Object.entries(t).forEach(e=>{let[r,t]=e;s.append(r,t)});let o={};this.accessToken&&(o.Authorization="Bearer ".concat(this.accessToken));try{let r=await fetch("".concat(this.baseUrl).concat(e),{method:"POST",headers:o,body:s});if(401===r.status&&this.refreshToken)try{await this.refreshAccessToken(),o.Authorization="Bearer ".concat(this.accessToken),r=await fetch("".concat(this.baseUrl).concat(e),{method:"POST",headers:o,body:s})}catch(e){return this.handleErrorResponse(r)}if(!r.ok)return this.handleErrorResponse(r);return{data:await r.json()}}catch(e){return{error:{code:"NETWORK_ERROR",message:e instanceof Error?e.message:"File upload failed"}}}}isAuthenticated(){return null!==this.accessToken}getAccessToken(){return this.accessToken}constructor(e){this.accessToken=null,this.refreshToken=null,this.refreshPromise=null,this.baseUrl=e.baseUrl.replace(/\/$/,""),this.onTokenRefresh=e.onTokenRefresh,this.onAuthError=e.onAuthError,this.onRequestStart=e.onRequestStart,this.onRequestEnd=e.onRequestEnd,this.onError=e.onError,this.retryConfig={maxRetries:3,retryDelay:1e3,retryableStatusCodes:[408,429,500,502,503,504],exponentialBackoff:!0,...e.retryConfig}}}let g={baseUrl:d.env.NEXT_PUBLIC_API_URL||"http://localhost:8080",onTokenRefresh:e=>{localStorage.setItem("access_token",e.access_token),localStorage.setItem("refresh_token",e.refresh_token)},onAuthError:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}};var f=t(1904);let p=(0,a.createContext)(null);function k(e){let{children:r,config:t={},queryClient:o}=e,[l]=(0,a.useState)(()=>new m({...g,...t})),[h,c]=(0,a.useState)(!1),[u]=(0,a.useState)(()=>o||new n.E({defaultOptions:{queries:{retry:(e,r)=>{var t;return(null==r||null==(t=r.response)?void 0:t.status)!==401&&e<3},staleTime:3e5,gcTime:6e5},mutations:{retry:!1}}}));return(0,a.useEffect)(()=>{(0,f.Aw)(l);{let e=localStorage.getItem("access_token"),r=localStorage.getItem("refresh_token");e&&r&&(l.setTokens(e,r),c(!0))}},[l]),(0,s.jsx)(p.Provider,{value:{client:l,isAuthenticated:h,login:(e,r)=>{l.setTokens(e,r),c(!0),localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",r)},logout:()=>{l.clearTokens(),c(!1),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),u.clear()}},children:(0,s.jsx)(i.Ht,{client:u,children:r})})}var y=t(2879),E=t(9349),T=t(4714);class S extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,r){var t,s;this.setState({error:e,errorInfo:r}),this.logError(e,r),null==(t=(s=this.props).onError)||t.call(s,e,r)}render(){if(this.state.hasError){var e;return this.props.fallback?this.props.fallback:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,s.jsx)("div",{className:"max-w-md w-full mx-auto p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(E.A,{className:"mx-auto h-12 w-12 text-destructive mb-4"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Something went wrong"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-6",children:"We're sorry, but something unexpected happened. Please try again."}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)(y.$,{onClick:this.handleRetry,className:"w-full",children:[(0,s.jsx)(T.A,{className:"mr-2 h-4 w-4"}),"Try Again"]}),(0,s.jsx)(y.$,{variant:"outline",onClick:this.handleReload,className:"w-full",children:"Reload Page"})]}),this.props.showDetails&&this.state.error&&(0,s.jsxs)("details",{className:"mt-6 text-left",children:[(0,s.jsx)("summary",{className:"cursor-pointer text-sm text-muted-foreground hover:text-foreground",children:"Error Details"}),(0,s.jsxs)("div",{className:"mt-2 p-3 bg-muted rounded-md text-xs font-mono",children:[(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("strong",{children:"Error:"})," ",this.state.error.message]}),this.state.error.stack&&(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("strong",{children:"Stack:"}),(0,s.jsx)("pre",{className:"whitespace-pre-wrap mt-1",children:this.state.error.stack})]}),(null==(e=this.state.errorInfo)?void 0:e.componentStack)&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Component Stack:"}),(0,s.jsx)("pre",{className:"whitespace-pre-wrap mt-1",children:this.state.errorInfo.componentStack})]})]})]})]})})})}return this.props.children}constructor(e){super(e),this.logError=(e,r)=>{try{let t={message:e.message,stack:e.stack,componentStack:r.componentStack,timestamp:new Date().toISOString(),url:window.location.href,userAgent:navigator.userAgent},s=JSON.parse(localStorage.getItem("error_logs")||"[]");s.push(t),s.length>10&&s.splice(0,s.length-10),localStorage.setItem("error_logs",JSON.stringify(s)),this.reportError(t)}catch(e){console.error("Failed to log error:",e)}},this.reportError=async e=>{try{await fetch("/api/v1/errors/report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"client_error",...e})})}catch(e){console.error("Failed to report error:",e)}},this.handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.handleReload=()=>{window.location.reload()},this.state={hasError:!1,error:null,errorInfo:null}}}function w(e){let{children:r}=e;return(0,a.useState)(()=>{h&&h.destroy(),h=new l({apiUrl:"/api/v1/errors/report",enableConsoleLog:!1})}),(0,s.jsx)(S,{showDetails:!1,onError:(e,r)=>{console.error("CMS Error Boundary:",e,r)},children:(0,s.jsx)(o.SessionProvider,{children:(0,s.jsx)(k,{children:r})})})}},9560:()=>{},9733:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,9560,23)),Promise.resolve().then(t.bind(t,1581))}},e=>{e.O(0,[929,96,76,289,358],()=>e(e.s=9733)),_N_E=e.O()}]);